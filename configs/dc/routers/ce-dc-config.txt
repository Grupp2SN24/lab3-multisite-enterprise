! CE-DC - Datacenter Customer Edge Router
! Last updated: 2025-12-07
! Features: VRFs, eBGP dual-homed, prefix-lists, BFD, communities
!
hostname CE-DC
!
vrf definition MGMT
 rd 65000:1
 address-family ipv4
 exit-address-family
!
vrf definition SERVICES
 rd 65000:2
 address-family ipv4
 exit-address-family
!
vrf definition USER
 rd 65000:3
 address-family ipv4
 exit-address-family
!
bfd slow-timers 2000
!
interface Loopback0
 ip address 1.1.1.1 255.255.255.255
!
interface GigabitEthernet0/0
 description SERVICES VRF Gateway
 ip address 10.10.0.1 255.255.255.0
!
interface GigabitEthernet0/1
 description Link to PE1
 ip address 192.168.100.1 255.255.255.252
 bfd interval 300 min_rx 300 multiplier 3
!
interface GigabitEthernet0/2
 description Link to PE2
 ip address 192.168.100.5 255.255.255.252
 bfd interval 300 min_rx 300 multiplier 3
!
interface GigabitEthernet0/3
 description MGMT VRF
 vrf forwarding MGMT
 ip address 10.0.0.1 255.255.255.0
!
router bgp 65000
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 neighbor 192.168.100.2 remote-as 65001
 neighbor 192.168.100.2 description PE1
 neighbor 192.168.100.2 fall-over bfd
 neighbor 192.168.100.6 remote-as 65001
 neighbor 192.168.100.6 description PE2
 neighbor 192.168.100.6 fall-over bfd
 !
 address-family ipv4
  network 10.0.0.0 mask 255.255.255.0
  network 10.10.0.0 mask 255.255.255.0
  network 10.20.0.0 mask 255.255.255.0
  redistribute connected
  neighbor 192.168.100.2 activate
  neighbor 192.168.100.2 send-community
  neighbor 192.168.100.2 prefix-list DC-IN in
  neighbor 192.168.100.2 prefix-list DC-OUT out
  neighbor 192.168.100.2 route-map PREFER-PE1 in
  neighbor 192.168.100.2 route-map SET-COMMUNITY-PE1 out
  neighbor 192.168.100.2 maximum-prefix 50 80 warning-only
  neighbor 192.168.100.6 activate
  neighbor 192.168.100.6 send-community
  neighbor 192.168.100.6 prefix-list DC-IN in
  neighbor 192.168.100.6 prefix-list DC-OUT out
  neighbor 192.168.100.6 route-map PREFER-PE2 in
  neighbor 192.168.100.6 route-map SET-COMMUNITY-PE2 out
  neighbor 192.168.100.6 maximum-prefix 50 80 warning-only
 exit-address-family
 !
 address-family ipv4 vrf MGMT
  redistribute connected
 exit-address-family
!
! === PREFIX LISTS ===
ip prefix-list DC-IN seq 10 permit 10.0.1.0/24
ip prefix-list DC-IN seq 20 permit 10.0.2.0/24
ip prefix-list DC-IN seq 30 permit 10.20.1.0/24
ip prefix-list DC-IN seq 40 permit 10.20.2.0/24
ip prefix-list DC-IN seq 50 permit 2.2.2.0/24 le 32
ip prefix-list DC-IN seq 60 permit 10.255.0.0/16 le 30
ip prefix-list DC-IN seq 70 permit 192.168.101.0/24 le 30
ip prefix-list DC-IN seq 80 permit 192.168.102.0/24 le 30
ip prefix-list DC-IN seq 1000 deny 0.0.0.0/0 le 32
!
ip prefix-list DC-OUT seq 10 permit 10.0.0.0/24
ip prefix-list DC-OUT seq 20 permit 10.10.0.0/24
ip prefix-list DC-OUT seq 30 permit 10.20.0.0/24
ip prefix-list DC-OUT seq 1000 deny 0.0.0.0/0 le 32
!
! === ROUTE MAPS ===
route-map PREFER-PE1 permit 10
 set local-preference 150
!
route-map PREFER-PE2 permit 10
 set local-preference 100
!
route-map SET-COMMUNITY-PE1 permit 10
 set community 65000:110
!
route-map SET-COMMUNITY-PE2 permit 10
 set community 65000:120
!
! === STATIC ROUTES ===
ip route 2.2.2.0 255.255.255.0 192.168.100.2
ip route 2.2.2.0 255.255.255.0 192.168.100.6 10
ip route 10.0.0.0 255.255.255.0 Null0
ip route 10.20.0.0 255.255.255.0 Null0
ip route 10.255.0.0 255.255.0.0 192.168.100.2
ip route 10.255.0.0 255.255.0.0 192.168.100.6 10
ip route 192.168.101.0 255.255.255.0 192.168.100.2
ip route 192.168.101.0 255.255.255.0 192.168.100.6 10
ip route 192.168.102.0 255.255.255.0 192.168.100.2
ip route 192.168.102.0 255.255.255.0 192.168.100.6 10
!
! === LOGGING ===
logging source-interface Loopback0
logging host 10.0.0.10 vrf MGMT
logging trap informational
!
end
